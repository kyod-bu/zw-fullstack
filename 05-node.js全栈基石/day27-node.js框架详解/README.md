# node.js 服务端框架及 ORM 框架介绍

## node.js 服务端框架 express

在 node.js 中，有⾮常多优秀的服务端框架，例如 express/koa/think/egg 等等，其中很多框架都是由国内的团队完成的，也取得了不错的反响。

⽽影响⼒最⼤的两个服务端框架就是 express 和 koa，它们在 node.js 服务端框架来说是⿐祖⼀般的存在，很多框架都是基于他们的思路来实现和封装的。

### express

在服务端，我们要区分清楚 request 和 response 的概念，request 是由客户端发起的，经过服务端处理之后，服务端的返回内容叫做 response。

之前我们也简单了解过，node.js 内部有⾮常多的内置模块，其中就有 http 模块，**express/koa 实际上就是对这个 http 模块的再封装**，增加了中间件策略和其他各种路由的通⽤处理，让我们写起来更加⽅便。

#### 使⽤ express 来定义⼀个 http 服务器

我们需要在⼀台已经安装了 node.js 的系统中，使⽤ npm 或其他包管理⼯具，安装我们的 express 框架。

```sh
npm install express
```

之后我们就能直接通过 node.js 的 CommonJS 模块化规范，加载 express 模块。

```js
/**
 * server.js
 * 使⽤ express 来定义⼀个 http 服务器
 */
const express = require('express');

const app = express();

// 快速定义一个路由
app.get('/', function(req, res) {
    // 正常，发送的 send 里面的内容
    res.send('hello express...');
});
  
app.listen(8080, function() {
    console.log('server start...');
});
```

#### 使⽤常见的 express 中间件

对于⼤型应⽤来说，我们的应⽤⼀般需要使⽤到 body-parser 和 cookie-parser 这两个中间件，他们的作⽤是处理我们常⻅请求中 body 和 cookie 的部分。

```js
// 中间件
function middleware(req, res, next) {
  // 1. express request 对象
  // 2. express response 对象
  // 3. express 的一个合法中间件
  console.log('hello middleware...');
}

// 使用中间件
app.use(middleware);
```

#### 编写一个自定义 express 中间件

这⾥我们可以⾃⾏编写⼀个业务中会使⽤到的中间件，来加深我们的理解。

```js
// 处理 404 响应
app.use(function(req, res, next) {
  res.status(404).send('Sorry cant find that!');
});
```

#### 中间件原理

中间件实际上我们可以这样理解，就是对于需要多次书写的业务逻辑，我们可以使⽤⼀种**切⾯的形式**，对相同逻辑进⾏通⽤处理。

## sequelize ORM 框架

### 数据库分类及 mysql 简介

数据库（db）就是⼀类数据存储的集合，他能帮助我们有效的存储数据，分类数据。

其实⽂件系统就可以理解为⼀种最简单的「数据库」，我们也可以简单的直接把内容存储在⽂件⾥⾯，最终⽂件放置在硬盘中。

但是⽂件系统我们⽆法针对某个内容做更详细的分析，排序等等操作，数据库内部会对我们存储的数据进⾏归类分析，使得我们通过数据库相关的 sql 语法，就能快速的找到匹配的数据，还能保证诸如事务⼀致性等等⾮常多的特性，对于我们业务中存储的数据来说，使⽤数据库是⾮常有优势的。

#### mysql

对于⼤多数⼊⻔级别的同学来说，我们只需要学习⼀种基础且简单的 mysql 数据库即可，其他的数据库我们就可以触类旁通。

⾸先我们可以⾃⾏的在我们的操作系统中安装⼀个 mysql 服务，设置好账号和密码，那么我们就可以通过账号密码登陆我们的数据库系统。

在 mysql 中，我们需要定义表（table）结构，每个表代表着⼀类数据的集合。例如对于⽤户来说，我们就可以定义⼀张⽤户表，把所有⽤户的数据存储在这⾥。

在定义表之前，我们还需要定义清楚每个表中存放哪些字段，这个字段对于这样表来说我们称之为列（column）。

具体的每⼀份数据，在我们的表中我们称之为⾏或者记录（record），这张表中的每⼀⾏记录，都有着我们定义的列中的数据。

### 为什么我们需要 ORM 框架

有的时候，我们使⽤ node.js 做⼀个脚本⼯具，写⼀些 node.js 脚本进⾏执⾏，有时候我们可以使⽤ node.js 做⼀个中间层，对我们的请求和响应做⼀些转发，有的时候我们可以直接把我们的 node.js 做为最终的服务器，让它直连数据库做⼀些⼤型应⽤。

❓但是直连数据库会有⼀些⼯业级的问题：

* 如何保证我们拼写的 sql 语句是正确的？如何防⽌出现数据库注⼊的问题？
* 对于不同的数据库例如 mysql，oracle ，或者相同数据库的不同版本，我如何去兼容它们的语法？

这时候就需要我们的 ORM 框架了，它帮助我们抹平了底层数据库的细节，我们使⽤这类框架，就能按照它的语法进⾏书写，最终⽣成能够应⽤于各个平台的 sql 语句。

### node.js ORM 框架 sequelize 简介

sequelize.js 就是⼀个在 node.js 中优秀的 ORM 框架，使⽤了 ORM 框架之后，只需要⼀些简单的学习，即使我们完全没有数据库相关知识，我们也能写好⼀个数据库应⽤。

我们只需要在我们的服务端 node.js 项⽬中，按照要求安装好这个库，在我们的 node.js 中定义下相关的 model ⽂件。

我们在写⼊数据了之后，就可以使⽤相关 model 上的⽅法，对数据进⾏增删改查了。
